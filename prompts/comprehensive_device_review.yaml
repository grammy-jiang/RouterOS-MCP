name: comprehensive-device-review
description: Complete device health, configuration, and security review

arguments:
  - name: device_id
    description: Device to review
    type: string
    required: true

messages:
  - role: user
    content: |
      # Comprehensive Device Review: {{ device_name }}
      
      ## Device Information
      - **Device ID:** {{ device_id }}
      - **Environment:** {{ device_environment }}
      - **Management Address:** {{ management_address }}
      
      ---
      
      ## Section 1: Connectivity and Basic Health
      
      ### 1.1 Connectivity Test
      **Tool:** `device/check-connectivity`
      **Status:** {{ '✓ Reachable' if reachable else '✗ Unreachable' }}
      
      ### 1.2 System Overview
      **Tool:** `system/get-overview`
      **Review:**
      - RouterOS version
      - Uptime
      - CPU usage
      - Memory usage
      - Temperature
      
      ### 1.3 Health Status
      **Resource:** `device://{{ device_id }}/health`
      **Review overall health state and recent checks**
      
      ---
      
      ## Section 2: Network Configuration
      
      ### 2.1 Interface Status
      **Tool:** `interface/list`
      **Check:**
      - All expected interfaces present
      - Interface status (UP/DOWN)
      - Traffic statistics
      - MTU settings
      
      ### 2.2 IP Addressing
      **Tool:** `ip/list-addresses`
      **Review:**
      - IP addresses on each interface
      - DHCP vs static configuration
      - Address conflicts
      
      ### 2.3 Routing
      **Tool:** `routing/list-routes`
      **Check:**
      - Default gateway present
      - Static routes correct
      - Dynamic routing protocol status
      
      ---
      
      ## Section 3: Services Configuration
      
      ### 3.1 DNS Configuration
      **Tool:** `dns/get-config`
      **Verify:**
      - DNS servers configured
      - DNS resolution working
      **Test:** `diagnostics/ping` to hostname
      
      ### 3.2 NTP Configuration
      **Tool:** `ntp/get-status`
      **Verify:**
      - NTP enabled
      - Time synchronized
      - Offset acceptable (<100ms)
      
      ---
      
      ## Section 4: Security Review
      
      ### 4.1 Firewall Rules
      **Tool:** `firewall/list-rules`
      **Review:**
      - Input chain rules (device protection)
      - Forward chain rules (traffic filtering)
      - Default policies
      - Rule ordering and optimization
      
      ### 4.2 Service Exposure
      **Check which RouterOS services are exposed:**
      - Telnet (should be disabled)
      - SSH (secure if needed)
      - REST API (required for MCP)
      - Winbox (consider restricting)
      - FTP (should be disabled)
      
      ### 4.3 User Accounts
      **Review:**
      - MCP service account exists
      - No unnecessary admin accounts
      - Strong password policy
      - Inactive accounts removed
      
      ---
      
      ## Section 5: Performance and Resource Usage
      
      ### 5.1 CPU and Memory Trends
      **Review historical data from health checks**
      - Average CPU usage
      - Peak CPU usage
      - Memory usage trends
      - Any resource constraints
      
      ### 5.2 Interface Statistics
      **Tool:** `interface/list`
      **Check:**
      - Bandwidth utilization
      - Packet errors
      - Drops and discards
      
      ---
      
      ## Section 6: Configuration and Compliance
      
      ### 6.1 Current Configuration
      **Resource:** `device://{{ device_id }}/config`
      **Review:**
      - Compare with baseline
      - Check for unauthorized changes
      - Verify compliance with standards
      
      ### 6.2 Recent Changes
      **Resource:** `audit://events/by-device/{{ device_id }}`
      **Review:**
      - Who made changes
      - What was changed
      - When changes occurred
      - Were changes authorized
      
      ---
      
      ## Section 7: Logs and Events
      
      ### 7.1 System Logs
      **Resource:** `device://{{ device_id }}/logs`
      **Look for:**
      - Error messages
      - Security events
      - Configuration changes
      - System reboots
      
      ### 7.2 Firewall Logs (if enabled)
      **Tool:** `firewall/get-logs`
      **Review:**
      - Blocked connection attempts
      - Security threats
      - Policy violations
      
      ---
      
      ## Review Checklist
      
      ### Health
      - [ ] Device reachable and responsive
      - [ ] CPU usage within normal range
      - [ ] Memory usage acceptable
      - [ ] Temperature normal
      - [ ] No hardware warnings
      
      ### Network
      - [ ] All interfaces operational
      - [ ] IP addressing correct
      - [ ] Routing functional
      - [ ] DNS resolution working
      - [ ] NTP synchronized
      
      ### Security
      - [ ] Firewall rules appropriate
      - [ ] Unnecessary services disabled
      - [ ] User accounts reviewed
      - [ ] Strong authentication in use
      - [ ] No security violations in logs
      
      ### Configuration
      - [ ] Config matches baseline
      - [ ] No unauthorized changes
      - [ ] Compliant with standards
      - [ ] Changes properly documented
      
      ### Performance
      - [ ] Resources adequate
      - [ ] No performance issues
      - [ ] Interface stats healthy
      - [ ] No packet loss
      
      ---
      
      ## Findings Summary
      
      **Document:**
      - Issues found (critical/warning/info)
      - Recommendations
      - Action items
      - Follow-up required
      - Next review date
      
      ---
      
      ## Recommended Actions
      
      Based on review findings:
      - Security hardening needed?
      - Configuration updates required?
      - Performance optimization?
      - Monitoring adjustments?
      - RouterOS upgrade recommended?

template_vars:
  device_name: "Unknown Device"
  device_environment: "unknown"
  management_address: "unknown"
  reachable: false

metadata:
  category: workflow
  tier: fundamental
  environments: [lab, staging, prod]
  requires_approval: false
